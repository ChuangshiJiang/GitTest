<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<input type="file" id="files-list"/>
<div id="progress"></div>
<div id="output"></div>
<script src="../js/EventUtil.js"></script>
<script>

    function blobSlice(blob, startByte, length) {
        if (blob.slice) {
            return blob.slice(startByte, length);
        } else if (blob.webkitSlice) {
            return blob.webkitSlice(startByte, length);
        } else if (blob.mozSlice) {
            return blob.mozSlice(startByte, length);
        } else {
            return null;
        }
    }

    //创建文件URL链接
    function createObjectURL(blob) {
        if (window.URL) {
            return window.URL.createObjectURL(blob);
        } else if (window.webkitURL) {
            return window.webkitURL.createObjectURL(blob);
        } else {
            return null;
        }
    }

    //解除文件URL链接
    function revokeObjectURL(url) {
        if (window.URL) {
            window.URL.revokeObjectURL(url);
        } else if (window.webkitURL.revokeObjectURL) {
            window.webkitURL.revokeObjectURL(url);
        }
    }

    EventUtil.addHandler(window, 'load', function () {

        //read file-name file-size and file-type
        var filesList = document.querySelector("#files-list");//获取文件input
        EventUtil.addHandler(filesList, 'change', function (event) {

            var info = '', output = document.getElementById('output'),
                progress = document.getElementById('progress'),
                files = EventUtil.getTarget(event).files, i = 0, len = files.length,
                type = 'default', reader = new FileReader();

            /*var url = createObjectURL(files[0]);
            if (url) {
                if (/image/.test(files[0].type)) {
                    output.innerHTML = '<img src=' + url + '>';
                } else {
                    output.innerHTML = 'Not a image!';
                }
            }*/

            revokeObjectURL(url);

            if (/image/.test(files[0].type)) {
                reader.readAsDataURL(files[0]);
                type = 'iamge';
            } else {
                reader.readAsText(files[0]);
                type = 'text';
            }

            reader.onerror = function () {
                output.innerHTML = 'Could not read file ,error code is:' + reader.error.code;
            }

            reader.onprogress = function (event) {
                if (event.lengthComputable) {
                    progress.innerHTML = event.loaded + '/' + event.total;
                }
            }

            reader.onload = function () {
                var html = '';
                switch (type) {
                    case 'iamge':
                        html = '<img src=\ ' + reader.result + ' \>';
                        break;
                    case 'text':
                        html = reader.result;
                        break;
                }

                output.innerHTML = html;

            }

            while (i < len) {
                console.log(files[i].name + '(' + files[i].type + ',' + files[i].size + 'bytes)');
                i++;
            }


        });

    });
</script>
</body>
</html>